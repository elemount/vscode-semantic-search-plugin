# VSCode Semantic Search Extension - v0.0.7

## Focus: Code Refactoring & Cleanup

Clean up technical debt by removing deprecated features, legacy code, and improving code organization. Make the codebase more maintainable and easier to understand.

## Goals

- **Remove deprecated/legacy code**: Clean up backwards compatibility and fallback code
- **Consolidate inline HTML/CSS**: Extract embedded HTML and CSS to separate files for better maintainability
- **Simplify configuration**: Remove deprecated settings and unused code paths

---

## 1. Remove Deprecated Line-based Chunking

### Objectives

- Remove the deprecated line-based chunking system (replaced by token-based in v0.0.4)
- Clean up legacy configuration properties
- Simplify the codebase to use only token-based chunking

### Implementation

1. **Remove deprecated config properties**
   - Delete `chunkSize` and `chunkOverlap` from `IndexingConfig` type
   - Remove from `DEFAULT_INDEXING_CONFIG` constant

2. **Remove fallback code**
   - Delete `splitIntoChunks()` function from `fileUtils.ts` (line-based chunking)
   - Remove fallback logic in `tokenChunker.ts` that falls back to line-based chunking when js-tiktoken is unavailable
   - Make js-tiktoken a required dependency (no fallback)

3. **Update documentation**
   - Remove mentions of deprecated chunking from comments
   - Update types documentation to reflect token-only approach

### Files to modify

- `src/models/types.ts` - Remove deprecated properties
- `src/utils/fileUtils.ts` - Remove `splitIntoChunks()` function
- `src/utils/tokenChunker.ts` - Remove fallback logic
- `package.json` - Remove deprecated settings
- `src/test/suite/tokenChunker.test.ts` - Remove fallback tests

---

## 2. Extract Inline HTML/CSS to Separate Files

### Objectives

- Move embedded HTML and CSS from TypeScript files to separate template files
- Improve maintainability and enable better IDE support for HTML/CSS
- Make it easier to style and update UI components

### Implementation

1. **Create template directory structure**
   ```
   src/views/templates/
     ├── searchSidebar.html
     ├── searchSidebar.css
     ├── searchResultsPanel.html
     └── searchResultsPanel.css
   ```

2. **Extract SearchSidebar templates**
   - Move HTML from `_getHtmlContent()` method to `searchSidebar.html`
   - Extract CSS `<style>` block to `searchSidebar.css`
   - Update method to read from template files using `vscode.Uri.joinPath()`
   - Use proper CSP nonce for inline scripts if needed

3. **Extract SearchResultsPanel templates**
   - Move HTML from `_getHtmlForWebview()` method to `searchResultsPanel.html`
   - Extract CSS `<style>` block to `searchResultsPanel.css`
   - Update method to read from template files

4. **Template loading utilities**
   - Create `src/utils/templateLoader.ts` with helpers:
     - `loadTemplate(templateName: string): string`
     - `loadCss(cssName: string): string`
   - Handle proper file path resolution and caching

5. **Build process**
   - Ensure template files are copied to `out/` directory during compilation
   - Update `.vscodeignore` to exclude source templates but include compiled ones

### Files to create

- `src/views/templates/searchSidebar.html`
- `src/views/templates/searchSidebar.css`
- `src/views/templates/searchResultsPanel.html`
- `src/views/templates/searchResultsPanel.css`
- `src/utils/templateLoader.ts`

### Files to modify

- `src/views/searchSidebar.ts` - Use template loader
- `src/views/searchResultsPanel.ts` - Use template loader
- `package.json` - Add template copy script if needed
- `tsconfig.json` - Configure to copy templates to out/

---

## 3. Remove Obsolete Documentation

### Objectives

- Clean up outdated RFC and planning documents
- Keep only relevant, current documentation

### Implementation

1. **Remove obsolete files**
   - Delete `doc/rfc/chroma.md` (ChromaDB was removed in v0.0.3)
   - Archive old plan files or consolidate into a single historical reference

2. **Update README**
   - Ensure no references to removed features
   - Update architecture section to reflect current state

### Files to delete

- `doc/rfc/chroma.md`

---

## 4. Code Cleanup & Simplification

### Objectives

- Remove unused imports and dead code
- Simplify complex conditional logic
- Ensure consistent code style

### Implementation

1. **TokenChunker simplification**
   - Since js-tiktoken is now required, remove all conditional logic around encoding availability
   - Always use token-based chunking
   - Simplify error handling

2. **Type cleanup**
   - Remove unused type properties
   - Update type documentation to be current
   - Remove legacy type aliases

3. **Linting improvements**
   - Run `eslint --fix` to auto-fix issues
   - Address any remaining manual lint warnings

### Files to review

- All files in `src/` for unused code
- Type definitions for accuracy

---

## Success Criteria

- [ ] No deprecated configuration properties remain
- [ ] All HTML/CSS extracted to separate template files
- [ ] No fallback code for unavailable dependencies
- [ ] All obsolete documentation removed
- [ ] All tests pass with simplified code
- [ ] Code coverage maintained or improved
- [ ] Bundle size reduced by removing dead code

---

## Migration Notes

**Breaking Changes:**
- Deprecated settings `semanticSearch.chunkSize` and `semanticSearch.chunkOverlap` removed
  - Users should use `semanticSearch.indexing.chunkMaxTokens` and `semanticSearch.indexing.chunkOverlapTokens` instead
- js-tiktoken is now a required dependency
  - Fallback to line-based chunking is no longer available

**For Users:**
- No action required if already using token-based settings
- Rebuild index recommended after upgrade for consistency

---

## Out of Scope (Future Versions)

- UI/UX redesign (keep existing functionality)
- Performance optimizations (focus on cleanup only)
- New features or capabilities
