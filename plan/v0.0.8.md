# VSCode Semantic Search Extension - v0.0.8

## Focus: Instant Activation with On-Demand Model Loading

Make extension available immediately by deferring model loading until first use.

## Goals

- **Instant activation**: Extension ready in <500ms without loading embedding model
- **Lazy model loading**: Load model only when user runs build/search commands
- **Non-blocking UI**: Show progress in status bar, never block activation

---

## Implementation

### 1. Refactor Activation (`extension.ts`)

```typescript
// Phase 1: Initialize DB only (fast, ~100ms)
vectorDbService = new VectorDbService(storagePath);
await vectorDbService.initialize();

// Phase 2: Register commands & views immediately
registerAllCommands();
registerAllViews();

// Mark ready - NO model loading
statusBarManager.updateStatus('ready', 'not-loaded');
```

### 2. Add Lazy Loading to EmbeddingService

- Add `ensureInitialized(): Promise<void>` method
- State: `'not-loaded' | 'loading' | 'ready' | 'error'`
- First call triggers model download with progress
- Subsequent calls return immediately

### 3. Update Commands

**Search & Build commands:**
```typescript
await embeddingService.ensureInitialized(); // Load on first use
// Then proceed with operation
```

**DB-only commands (view, delete):** Work immediately without model

### 4. Update StatusBarManager

- Initial: `"$(database) Ready (Model: On-demand)"`
- Loading: `"$(sync~spin) Loading model... 45%"`
- Ready: `"$(check) Search Ready"`

---

## Files to Modify

- `src/extension.ts` - Remove blocking model load
- `src/services/embeddingService.ts` - Add `ensureInitialized()`
- `src/services/statusBarManager.ts` - Add model status states
- `src/commands/buildIndex.ts` - Add lazy load call
- `src/commands/search.ts` - Add lazy load call

---

## Success Criteria

✓ Extension activates in <500ms  
✓ DB operations available immediately  
✓ Model loads only on first search/build  
✓ Progress shown in status bar (non-blocking)  
✓ Users browsing index never download model
