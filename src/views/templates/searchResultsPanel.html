<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Results</title>
    <style>{{CSS_CONTENT}}</style>
</head>
<body>
    <div class="header">
        <h1>Results for "<span class="query">{{QUERY}}</span>"</h1>
        <span class="result-count" id="resultCount">{{RESULT_COUNT}} result(s)</span>
    </div>
    
    <div class="filters">
        <div class="filter-group">
            <label>File type:</label>
            <select id="typeFilter" onchange="filterByType(this.value)">
                {{TYPE_FILTERS}}
            </select>
        </div>
        <div class="filter-group">
            <label>Folder:</label>
            <select id="folderFilter" onchange="filterByFolder(this.value)">
                {{FOLDER_FILTERS}}
            </select>
        </div>
        <div class="filter-group">
            <label>Sort by:</label>
            <select id="sortBy" onchange="sortBy(this.value)">
                <option value="relevance">Relevance</option>
                <option value="path">File path</option>
                <option value="lines">Line number</option>
            </select>
        </div>
    </div>
    
    <div class="results" id="results">
        {{RESULTS_HTML}}
    </div>
    
    <script>
        const vscode = acquireVsCodeApi();
        
        function openFile(filePath, lineStart, lineEnd) {
            vscode.postMessage({
                command: 'openFile',
                filePath: filePath,
                lineStart: lineStart,
                lineEnd: lineEnd
            });
        }
        
        function filterByType(extension) {
            vscode.postMessage({
                command: 'filterByType',
                extension: extension
            });
        }
        
        function filterByFolder(folder) {
            vscode.postMessage({
                command: 'filterByFolder',
                folder: folder
            });
        }
        
        function sortBy(field) {
            vscode.postMessage({
                command: 'sortBy',
                sortField: field
            });
        }
        
        window.addEventListener('message', event => {
            const message = event.data;
            if (message.command === 'updateResults') {
                document.getElementById('results').innerHTML = renderResults(message.results);
                document.getElementById('resultCount').textContent = message.results.length + ' result(s)';
            }
        });
        
        function renderResults(results) {
            if (results.length === 0) {
                return '<div class="no-results">No results match your filters</div>';
            }
            return results.map(r => `
                <div class="result-card">
                    <div class="result-header" onclick="openFile('\${escapeHtml(r.filePath)}', \${r.lineStart}, \${r.lineEnd})">
                        <div class="result-path">
                            <span class="result-index">#\${r.index}</span>
                            <span class="icon">ðŸ“„</span>
                            <span class="result-file">\${escapeHtml(r.relativePath)}</span>
                            <span class="result-lines">Lines \${r.lineStart}-\${r.lineEnd}</span>
                        </div>
                        <div class="result-score">
                            <div class="score-bar">
                                <div class="score-fill" style="width: \${r.scorePercent}%"></div>
                            </div>
                            <span class="score-text">\${r.scorePercent}%</span>
                        </div>
                    </div>
                    <div class="result-content">
                        <pre><code>\${escapeHtml(r.content.substring(0, 500))}\${r.content.length > 500 ? '...' : ''}</code></pre>
                    </div>
                </div>
            `).join('');
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>
